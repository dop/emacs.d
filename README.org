#+TITLE: README

* Install

#+begin_src shell
git clone git://git.sv.gnu.org/emacs.git
git checkout emacs-28 # or whatever version
#+end_src

Alternatively, since Emacs history is long and repository is big, we can retrieve only the current source:

#+begin_src shell
git clone --depth 1 --branch emacs-28 git://git.sv.gnu.org/emacs.git
#+end_src

Below are some of the build recipes for the machines I use.

** Ubuntu
Dependencies:
#+begin_src shell
  apt install \
      libgtk-3-dev texinfo \
      libgccjit-9-dev libncurses-dev libgnutls28-dev libgif-dev \
      libxpm-dev libjansson-dev libmagickwand-dev libmagickcore-dev
#+end_src

Configure:
#+begin_src shell
  ./configure --prefix=$HOME/.local --with-x-toolkit=gtk3 --with-cairo \
              --with-imagemagick --with-json --with-harfbuzz --with-jpeg --with-png \
              --with-pdf --with-gif --with-tiff --with-xpm --with-gnutls \
              --with-native-compilation
#+end_sr
** MacOS

For older versions of Emacs, use [[https://www.macports.org/][MacPorts]] to install [[https://github.com/akheron/jansson][jansson]].

#+begin_src shell
  ./autogen.sh
  ./configure
  make install
  mv nextstep/Emacs.app /Applications
#+end_src

Disable MacOS handling of =Control-Command-D= (show/hide word definition):

#+begin_src shell
defaults write com.apple.symbolichotkeys AppleSymbolicHotKeys -dict-add 70 '<dict><key>enabled</key><false/></dict>'
#+end_src

Trigger disabled hotkey to take effect:

#+begin_src shell
/System/Library/PrivateFrameworks/SystemAdministration.framework/Resources/activateSettings -u
#+end_src

For crisper fonts:

#+begin_src shell
defaults write org.gnu.Emacs AppleFontSmoothing -int 0
#+end_src

Reading from TTY speed improvement.

#+begin_src diff
  diff --git a/src/sysdep.c b/src/sysdep.c
  index 2f5572009fb..e70e4c3508d 100644
  --- a/src/sysdep.c
  +++ b/src/sysdep.c
  @@ -2778,6 +2778,23 @@ emacs_intr_read (int fd, void *buf, ptrdiff_t nbyte, bool interruptible)
       }
     while (result < 0 && errno == EINTR);

  +#ifdef DARWIN_OS
  +  if ((result == 1024) && (nbyte > result) && isatty(fd))
  +    {
  +      ssize_t n;
  +      do
  +	{
  +	  usleep (25);
  +	  if (interruptible)
  +	    maybe_quit ();
  +	  n = read (fd, buf + result, nbyte - result);
  +	  if (n > 0)
  +	    result += n;
  +	}
  +      while ((n < 0 && errno == EINTR) || (n > 0));
  +    }
  +#endif
  +
     return result;
   }

#+end_src
